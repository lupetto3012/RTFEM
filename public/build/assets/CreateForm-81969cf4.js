import{T as p,r as m,o as a,c as f,w as v,a as s,n as h,b as g,v as b,d as n,t as u,e as d,f as D,F as w,g as y,h as C}from"./app-906289e7.js";import{_ as k,L as _}from"./Layout-5d142be8.js";const x={components:{Layout:_},data(){return{form:p({log:null,highlights:[]}),random:null,showModal:!1,uploading:!1,uploadProgress:0,isDragging:!1,saveHint:null}},methods:{init(){},submit(){this.form.put("/",{onSuccess:o=>{this.random=o.props.random,this.showModal=!0,this.reset()},onError:()=>{alert("Error...")}})},selectHighlight(){const o=this.$refs.log,e=this.form.log.slice(o.selectionStart,o.selectionEnd);this.form.highlights.includes(e)||this.form.highlights.push(e)},copyToClipboard(){copyToClipboard(this.viewUrl)},clearHighlights(){window.getSelection().removeAllRanges(),this.form.highlights=[]},handleTextareaChange(){(!this.form.log||this.form.log.length===0)&&this.clearHighlights()},reset(){this.form.reset()},handleFileDrop(o){o.preventDefault(),this.isDragging=!1;for(const e of o.dataTransfer.files){this.ocr(e);break}},ocr(o){this.uploading=!0;let e=new FormData;e.append(o.name,o),axios.post("/ocr",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:i=>{this.uploadProgress=Math.ceil(i.loaded/i.total*100/5)*5}}).then(i=>{this.form.log=i.data.text}).catch(i=>{alert("Error during OCR processing...")}).finally(i=>{this.uploading=!1})},handleFileDragOver(o){o.preventDefault(),this.isDragging=!0},handleFileDragLeave(o){o.preventDefault(),this.isDragging=!1}},computed:{viewUrl(){return window.location+this.random},dropClass(){return this.isDragging?"border-success":""}},mounted(){this.init(),emitter.on("keypress-ctrl-s",o=>{o.preventDefault(),this.submit()}),document.onpaste=o=>{const i=(o.clipboardData||window.clipboardData).files[0];i!==null&&this.ocr(i)}},watch:{}},F={class:"row flex-center child-borders child-shadows"},T={class:"form-group"},H=s("label",null,"Error message",-1),M={key:0,class:"progress"},L={key:1},E={class:"col-2 col border-dashed ml-2"},S={class:"form-group h-100"},U=s("label",{for:"paperInputs1"},"Highlights",-1),O=["value"],P={class:"row flex-center"},V={class:"col-8 col"},B={class:"modal"},z=s("label",{class:"modal-bg",for:"modal-1"},null,-1),N={class:"modal-body"},R=s("label",{class:"btn-close",for:"modal-1"},"X",-1),I=s("h4",{class:"modal-title"},"Here's your link...",-1),j=["value"];function A(o,e,i,X,l,r){const c=m("Layout");return a(),f(c,null,{default:v(()=>[s("div",F,[s("div",{class:h("col-6 col border-dashed "+r.dropClass),onDrop:e[3]||(e[3]=(...t)=>r.handleFileDrop&&r.handleFileDrop(...t)),onDragover:e[4]||(e[4]=(...t)=>r.handleFileDragOver&&r.handleFileDragOver(...t)),onDragleave:e[5]||(e[5]=(...t)=>r.handleFileDragLeave&&r.handleFileDragLeave(...t))},[s("div",T,[H,g(s("textarea",{ref:"log",class:"input-block no-resize p-5","onUpdate:modelValue":e[0]||(e[0]=t=>l.form.log=t),rows:"15",onSelect:e[1]||(e[1]=t=>r.selectHighlight()),onInput:e[2]||(e[2]=t=>r.handleTextareaChange()),placeholder:"Drop or paste image to automatically read error message or just type something..."},null,544),[[b,l.form.log]])]),l.uploading?(a(),n("div",M,[s("div",{class:h("bar striped w-"+l.uploadProgress),role:"progressbar"},u(l.uploadProgress)+"% ",3)])):d("",!0),l.uploading?(a(),n("div",L,"OCR processing...")):d("",!0)],34),s("div",E,[s("div",S,[U,(a(!0),n(w,null,D(l.form.highlights,t=>(a(),n("input",{class:"input-block",value:t,type:"text"},null,8,O))),256))]),l.form.highlights.length>0?(a(),n("button",{key:0,class:"btn-block btn-small btn-danger-outline",onClick:e[6]||(e[6]=t=>r.clearHighlights())},"Clear highlights")):d("",!0)])]),s("div",P,[s("div",V,[s("button",{class:"btn-block btn-secondary",onClick:e[7]||(e[7]=t=>r.submit()),onMouseover:e[8]||(e[8]=t=>l.saveHint="(Ctrl + S would also work)"),onMouseout:e[9]||(e[9]=t=>l.saveHint="")},[y("Create link "),s("small",null,u(l.saveHint),1)],32)])]),g(s("input",{class:"modal-state",id:"modal-1","onUpdate:modelValue":e[10]||(e[10]=t=>l.showModal=t),type:"checkbox"},null,512),[[C,l.showModal]]),s("div",B,[z,s("div",N,[R,I,s("input",{class:"input-block",value:r.viewUrl,disabled:"",type:"text",size:"50"},null,8,j),s("button",{class:"btn-block btn-primary mt-2",onClick:e[11]||(e[11]=t=>r.copyToClipboard())},"Copy to clipboard")])])]),_:1})}const J=k(x,[["render",A]]);export{J as default};
